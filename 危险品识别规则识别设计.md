好的，这是一个极具挑战性也极具价值的需求。处理非标准格式的危险品文件，并从中提炼出可复用的规则，是产品从“自动化工具”迈向“智能知识平台”的关键一步。

这个功能我将其命名为 **“智能文档学习与规则生成器” (Intelligent Document Learning & Rule Generator)**。下面是这个功能的详细产品功能设计说明。

---

### **产品功能设计说明：智能文档学习与规则生成器**

#### **1. 功能概述 (Feature Overview)**

本功能旨在解决用户处理非SDS/MSDS标准格式的危险品相关文件（如技术说明书、检测报告、商业发票、合同条款等）的需求。通过AI驱动的“无监督/半监督学习”流程，系统能够从这些非结构化或半结构化的文档中学习关键信息，并在人工指导下，将其转化为可沉淀、可复用的危险品识别规则，最终扩充产品的核心规则库。

**核心价值**:
*   **扩展适用范围**: 将产品的能力从标准SDS文件扩展到几乎任何包含危险品信息的文档。
*   **知识自动化沉淀**: 将专家的零散判断经验，转化为系统化的、可自动执行的规则。
*   **持续自我优化**: 产品会随着处理的非标文档增多而变得越来越“聪明”，识别能力和自动化程度持续提升。

#### **2. 用户故事 (User Stories)**

*   **作为一名合规专员**，我收到一份供应商提供的产品技术规格书（非SDS格式），我希望能快速上传它，让系统帮我找出其中潜在的危险信息，并判断该产品是否需要按危险品管理。
*   **作为一名产品管理员**，当我确认一份技术规格书中的某个产品是危险品后，我希望系统能帮我把这次的判断依据（例如，文档中提到了‘闪点低于60°C’）保存为一条新规则，这样下次遇到类似规格书时系统就能自动识别了。
*   **作为一名IT系统负责人**，我希望这个新功能是可控的，所有AI生成的“建议规则”都必须经过专家审核才能生效，以确保规则库的准确性和权威性。

#### **3. 功能模块与流程设计 (Module & Workflow Design)**

我们将整个流程设计为一个引导式、人机协作的“三步工作流”：**上传与预处理 -> 引导式标注与验证 -> 规则生成与审核**。

##### **模块一：文档上传与智能预处理 (Upload & Pre-processing)**

当用户上传一个非SDS/MSDS文件时，系统不再执行标准SDS的解析流程，而是进入此模块。

*   **3.1 文件类型选择**:
    *   在上传界面，增加一个选项：“文件类型：[ (o) 标准SDS/MSDS ] [ ( ) 其他文档 ]”。
    *   用户选择“其他文档”后，进入本功能的专属处理界面。

*   **3.2 AI驱动的预处理**:
    *   **文本提取**: 无论文件是PDF、Word还是图片，首先通过OCR和文本解析技术，将其转换为纯文本。
    *   **关键信息预识别 (AI Suggestion)**: 后端AI模型（基于大语言模型LLM，如GPT-4或类似模型）会快速通读全文，并尝试“猜测”和“高亮”出可能与危险品相关的关键信息。这**不是最终结论**，而是给用户的“智能提示”。
        *   **预识别的实体类型**:
            *   **化学品标识**: 产品名称、CAS号、UN编号。
            *   **物理化学特性**: 闪点 (Flash Point)、沸点 (Boiling Point)、爆炸极限 (Explosion Limit)、pH值。
            *   **危险性描述词**: `易燃 (Flammable)`、`腐蚀性 (Corrosive)`、`有毒 (Toxic)`、`爆炸 (Explosive)`、`警告 (Warning)`、`危险 (Danger)`。
            *   **法规/标准引用**: `IATA DGR`、`IMDG Code`、`GB 12268`。

##### **模块二：引导式标注与验证 (Guided Annotation & Verification)**

这是人机交互的核心。界面会并排展示文档原文和AI预识别的结果，引导用户进行确认和标注。

*   **3.3 交互式标注界面**:
    *   **左侧**: 显示文档原文。AI预识别出的关键词或句子会以虚线高亮显示。
    *   **右侧**: 一个结构化的“危险品信息卡片”，包含一系列待填充的字段（如UN编号、危险类别、包装组、闪点等）。
    *   **交互流程**:
        1.  用户点击左侧原文中一个高亮区域（如“闪点: 23°C”）。
        2.  系统弹出提示：“AI建议将‘23°C’标注为 **[闪点]**，是否确认？”
        3.  用户点击“确认”，该值自动填充到右侧信息卡片的“闪点”字段中。
        4.  如果AI没有识别出某个信息（如UN编号），用户可以手动在原文中选中“UN1263”，然后右键或拖拽，在弹出的菜单中选择要标注的字段类型 **[UN编号]**。该值同样会自动填充到卡片中。
        5.  所有关键信息都从原文标注并填充到右侧卡片后，用户对卡片信息进行最终确认。

*   **3.4 判断与依据确认**:
    *   在信息卡片下方，用户需要做出最终判断：“该产品是否为危险品？[ (o) 是 ] [ ( ) 否 ]”。
    *   用户做出选择后，系统会要求其确认本次判断的核心依据，即在右侧卡片中勾选一个或多个关键信息字段（例如，勾选“闪点”和“UN编号”）。

##### **模块三：规则生成与审核 (Rule Generation & Review)**

当用户完成标注和判断后，系统进入最智能的一步：将这次人工操作转化为机器规则。

*   **3.5 智能规则草稿生成**:
    *   系统根据用户在3.4中勾选的核心依据，自动生成一条人类可读的规则草稿。
    *   **规则模板**: `如果 文档类型为 [用户可定义，如'技术规格书'] 且 文档中包含 [依据1的文本模式] 并且 [依据2的文本模式] ... 那么 判定为 [危险品/非危险品] 并且 提取 [字段名] 为 [字段值]`。
    *   **示例**:
        *   **用户操作**: 标注了“闪点: 23°C”，并判定为危险品。
        *   **系统生成规则草稿**: `如果 文档中存在文本模式 "闪点[:：\s]*(\d+)[°C]?" 且 该数值小于 60，那么 判定为 [危险品] 并且 提取该数值为 [闪点]`。
        *   **用户操作**: 标注了产品名“ABC清洁剂”和CAS号“123-45-6”，并判定为危险品。
        *   **系统生成规则草稿**: `如果 文档中同时存在 "ABC清洁剂" 和 "123-45-6"，那么 判定为 [危险品]`。

*   **3.6 规则审核与入库**:
    *   生成的规则草稿不会立即生效。它会被提交到“**规则审核中心**”。
    *   只有被授予“管理员”或“规则审核员”权限的用户才能看到这个中心。
    *   **审核界面**:
        *   列出所有待审核的规则草稿。
        *   每一条规则都附有其来源（源自哪个文件的哪次判断）、创建人、创建时间。
        *   审核员可以对规则进行**编辑**（如调整数值范围、修改文本匹配模式）、**批准**或**拒绝**。
        *   **批准后**，该规则正式进入产品的主规则库，在未来的自动化处理中生效。
        *   **拒绝后**，该规则被丢弃，但本次的人工判断结果依然被记录在历史中。

#### **4. 技术实现要点 (Technical Implementation Notes)**

*   **AI模型**: 建议使用具备强大上下文理解和零样本/少样本学习能力的大语言模型（LLM）作为预识别引擎。模型需要经过微调，以更好地识别危险品领域的专有术语。
*   **规则表示**: 规则不应是硬编码的`if-else`，而应采用灵活的格式（如JSON或YAML），支持正则表达式、数值比较、关键词组合等多种匹配逻辑。
*   **权限控制**: 必须建立严格的角色权限体系（普通用户、管理员/审核员），确保规则库的质量和安全。


---

### **界面原型图：智能文档学习与规则生成器**

#### **第一步：上传与预处理 (Upload & Pre-processing)**

**目标**: 用户上传非标文档，系统进行后台AI预处理。

**界面名称**: `文件上传` (模态框或独立页面)

```
+------------------------------------------------------------------+
|                      上传新文档进行学习                          |
|                                                            [ X ] |
+------------------------------------------------------------------+
|                                                                  |
|   [ + 从本地选择文件 或 将文件拖拽到此处 ]                       |
|   (支持 .pdf, .docx, .jpg, .png 等格式)                          |
|                                                                  |
|   文件名: supplier_spec_xyz.pdf [删除]                           |
|                                                                  |
|   ------------------------------------------------------------   |
|                                                                  |
|   请选择文档类型:                                                |
|                                                                  |
|   [ (o) 标准SDS/MSDS ]  (系统将按标准流程解析)                   |
|                                                                  |
|   [ ( ) 其他文档 ]      (将启动智能学习与规则生成流程)           |
|                                                                  |
|   ------------------------------------------------------------   |
|                                                                  |
|   [               开始处理 (按钮, 灰色不可点)                ]   |
|                                                                  |
+------------------------------------------------------------------+
```

**交互流程**:
1.  用户点击“+”或拖拽文件，文件名出现在下方。
2.  用户选择文件类型。当选择 **`[ (o) 其他文档 ]`** 时，“开始处理”按钮变为蓝色可点击状态。
3.  用户点击 **`[ 开始处理 ]`** 按钮。
4.  界面跳转到第二步，同时后台开始对文档进行OCR和AI预处理。界面中央显示加载动画和提示：“AI正在阅读和预分析文档，请稍候...”。

---

#### **第二步：引导式标注与验证 (Guided Annotation & Verification)**

**目标**: 人机协作，从原文中提取关键信息并完成判断。

**界面名称**: `智能标注台`

```
+----------------------------------------------------------------------------------------------------+
| 产品名称: [ 手动输入或从文档标注 ]      处理状态: [ 待标注 ]      [ 保存草稿 ] [ 放弃 ]             |
+----------------------------------------------------------------------------------------------------+
| [ 左侧: 文档原文预览 (70%宽度) ]              | [ 右侧: 危险品信息卡片 (30%宽度) ]                     |
|-----------------------------------------------|----------------------------------------------------|
|                                               |                                                    |
| ABC化工技术规格书                             | **1. 标注关键信息**                                |
| ...                                           |   (从左侧文档中选择文本进行标注)                   |
| 技术参数:                                     |                                                    |
| - <虚线高亮>闪点: 23°C</虚线高亮>              |   产品名称: [ ABC化工 ] [x]                        |
| - <虚线高亮>CAS号: 71-43-2</虚线高亮>           |   CAS 号:   [ 71-43-2 ] [x]                        |
| - 物理形态: 液体                              |   UN 编号:  [ ________ ] (点击此处从原文标注)      |
| ...                                           |   闪点:     [ 23°C ] [x]                           |
| 安全建议:                                     |   危险类别: [ ________ ]                           |
| 本品<虚线高亮>高度易燃</虚线高亮>，操作时...   |   包装组:   [ ________ ]                           |
| ...                                           |   [ + 添加其他信息字段 ]                           |
|                                               |                                                    |
|                                               | **2. 做出判断**                                    |
|                                               |   该产品是否为危险品?                              |
|                                               |   [ (o) 是 ]  [ ( ) 否 ]                           |
|                                               |                                                    |
|                                               | **3. 选择判断依据** (请勾选核心依据)               |
|                                               |   [√] CAS 号: 71-43-2                              |
|                                               |   [ ] UN 编号:                                     |
|                                               |   [√] 闪点: 23°C (低于60°C)                        |
|                                               |                                                    |
|                                               | -------------------------------------------------- |
|                                               | [         完成标注并生成规则 (按钮)          ]     |
|                                               |                                                    |
+----------------------------------------------------------------------------------------------------+
```

**交互流程**:
1.  **AI预标注**: 进入界面时，左侧原文中被AI识别为潜在关键信息的文本已用“虚线高亮”标出。
2.  **确认标注**:
    *   用户点击左侧高亮的 `闪点: 23°C`。
    *   系统弹窗：“AI建议将'23°C'标注为 **[闪点]**”。用户点击“确认”。
    *   `23°C` 自动填充到右侧“闪点”字段，左侧的高亮变为实线，表示已确认。
3.  **手动标注**:
    *   右侧“UN 编号”字段为空。用户点击该字段，系统提示“请在左侧原文中选择对应文本”。
    *   用户在左侧找到并用鼠标选中 `UN 1114` (假设原文中有)。
    *   松开鼠标后，系统弹窗：“将'UN 1114'标注为 **[UN 编号]**？”。用户确认。
    *   `UN 1114` 自动填充到右侧字段。
4.  **完成判断**: 用户在右侧信息卡片下方，选择“是”或“否”危险品，并勾选作为本次判断主要依据的字段（如“闪点”）。
5.  **进入下一步**: 用户点击 **`[ 完成标注并生成规则 ]`** 按钮，进入第三步。

---

#### **第三步：规则生成与审核 (Rule Generation & Review)**

**目标**: 系统自动生成规则草稿，用户进行最终确认或提交审核。

**界面名称**: `规则生成与入库`

```
+------------------------------------------------------------------+
|                      规则生成与入库                              |
+------------------------------------------------------------------+
|                                                                  |
|   系统已根据您的标注和判断，生成了以下规则草稿。                 |
|   请审核并确认，批准后的规则将用于未来自动识别。                 |
|                                                                  |
|   **来源文档**: supplier_spec_xyz.pdf                            |
|   **您的判断**: 是危险品                                         |
|                                                                  |
|   ------------------- [ 规则草稿 1 ] -------------------        |
|                                                                  |
|   **规则描述**: 根据闪点判断为危险品                             |
|                                                                  |
|   **IF (如果)**:                                                 |
|     - 文档中存在文本模式: `闪点[:：\s]*(\d+)` (匹配"闪点"后的数字) |
|     - **并且** 提取的数值 `小于` `60`                            |
|                                                                  |
|   **THEN (那么)**:                                               |
|     - `判定结果` 设置为 `是危险品`                               |
|     - `危险类别` 建议为 `3 (易燃液体)`                           |
|                                                                  |
|   [ 编辑规则逻辑 ]                                               |
|                                                                  |
|   ------------------- [ 规则草稿 2 ] -------------------        |
|                                                                  |
|   **规则描述**: 根据CAS号直接判定                                |
|                                                                  |
|   **IF (如果)**:                                                 |
|     - 文档中存在文本: `71-43-2`                                  |
|                                                                  |
|   **THEN (那么)**:                                               |
|     - `判定结果` 设置为 `是危险品`                               |
|     - `产品名称` 建议为 `苯`                                     |
|                                                                  |
|   [ 编辑规则逻辑 ] [ 删除此条规则 ]                              |
|                                                                  |
|   ------------------------------------------------------------   |
|                                                                  |
|   **操作选项**:                                                  |
|                                                                  |
|   [ (√) 批准并存入规则库 ] (如果您有权限)                        |
|                                                                  |
|   [ (>) 提交给管理员审核 ] (推荐)                                |
|                                                                  |
|   [ (<) 返回修改标注 ]                                           |
|                                                                  |
+------------------------------------------------------------------+
```

**交互流程**:
1.  **规则展示**: 系统将自动生成的、人类可读的规则草稿展示给用户。每条规则都清晰地列出了`IF`（条件）和`THEN`（执行动作）。
2.  **编辑与调整**: 如果用户具备高级知识，可以点击`[ 编辑规则逻辑 ]`，进入一个更专业的界面，调整正则表达式、数值比较符或输出结果。
3.  **最终决策**:
    *   如果用户是**管理员**，可以直接点击 **`[ (√) 批准并存入规则库 ]`**。规则立即生效，界面提示“操作成功，规则已入库！”，流程结束。
    *   如果用户是**普通用户**，该按钮为灰色不可点。用户应点击 **`[ (>) 提交给管理员审核 ]`**。界面提示“提交成功，请等待管理员审核。”，流程结束。
    *   如果用户发现标注有误，可以点击 **`[ (<) 返回修改标注 ]`**，退回到第二步的界面。

这套原型图完整地覆盖了从未知文档到可复用规则的全过程，强调了人机协作和流程引导，确保了最终生成规则的准确性和可用性。

---
接下来，我们可以：
*   基于这个原型图，讨论每个按钮点击后具体的API请求和后端处理逻辑。
*   细化“规则审核中心”的管理界面设计。
*   探讨如何将这个流程与现有的SDS处理流程在产品主界面上进行整合。