# 工作流测试功能使用指南

## 功能概述

工作流测试功能允许你在前端界面上模拟用户输入，实时查看工作流执行过程中的每个节点的状态和反馈数据。

## 使用步骤

### 1. 启动后端 API 服务

```bash
python api_server.py
```

服务将在 `http://localhost:8000` 启动。

### 2. 启动前端开发服务器

```bash
cd frontend
npm run dev
```

### 3. 使用测试功能

1. **构建工作流**
   - 在画布上拖拽节点构建你的工作流
   - 配置每个节点的参数（智能体配置、条件表达式等）
   - 连接节点形成完整的执行流程

2. **打开测试对话框**
   - 点击顶部工具栏的"测试"按钮（绿色按钮）
   - 测试对话框将弹出

3. **输入测试数据**
   - 在"测试输入"文本框中输入模拟的用户请求
   - 例如：`"请帮我生成一个用户管理页面"`

4. **开始测试**
   - 点击"开始测试"按钮
   - 系统将实时显示执行日志

5. **查看执行过程**
   - **执行日志区域**：显示每个节点的执行状态
     - ✓ 绿色：节点执行成功
     - ✗ 红色：节点执行失败
     - ⚠ 黄色：条件判断结果
     - • 蓝色：一般信息
   
   - **输出结果区域**：显示工作流的最终输出

## 支持的节点类型

### InputNode（输入节点）
- 接收用户输入
- 无需特殊配置

### AgentNode（智能体节点）
- 执行智能体任务
- 显示初始化和执行过程

### ConditionNode（条件分支节点）
- 根据条件表达式判断走向
- 显示判断结果（True/False）
- 显示条件表达式内容

### ParallelNode（并行执行节点）
- 同时执行多个分支
- 显示并行分支数量
- 显示每个分支的执行情况

### OutputNode（输出节点）
- 输出最终结果
- 在"输出结果"区域显示

## 实时反馈事件类型

| 事件类型 | 说明 | 显示内容 |
|---------|------|---------|
| `log` | 一般日志信息 | 系统消息、初始化信息 |
| `node_start` | 节点开始执行 | 节点名称 + "开始执行节点" |
| `node_complete` | 节点执行完成 | 节点名称 + "节点执行完成" |
| `node_error` | 节点执行失败 | 节点名称 + 错误信息 |
| `condition_result` | 条件判断结果 | 条件表达式 + True/False |
| `parallel_start` | 并行执行开始 | 分支数量 |
| `output` | 最终输出 | 输出内容 |

## 示例工作流测试

### 示例 1：条件分支工作流

**工作流：** `example_condition_workflow.json`

**测试输入：**
```
请帮我生成一个用户管理页面
```

**预期结果：**
- Router 分析请求，输出包含 "code"
- 条件节点判断为 True
- 执行 CodeMaster 生成代码
- 输出代码配置

### 示例 2：并行执行工作流

**工作流：** `example_parallel_workflow.json`

**测试输入：**
```
分析用户数据并生成管理界面
```

**预期结果：**
- 并行节点同时启动两个分支
- CodeMaster 和 DataAnalyst 同时执行
- 合并两个智能体的输出结果

## 技术实现

### 前端
- **组件：** `WorkflowTestDialog.vue`
- **通信方式：** Server-Sent Events (SSE)
- **实时更新：** 流式接收后端事件

### 后端
- **API 端点：** `POST /api/workflow/test`
- **响应类型：** `text/event-stream`
- **执行引擎：** 基于图遍历的异步执行

## 注意事项

1. **API 服务必须运行**
   - 测试功能依赖后端 API 服务
   - 确保 `api_server.py` 正在运行

2. **工作流必须有输入节点**
   - 系统从 InputNode 开始执行
   - 没有输入节点将无法执行

3. **智能体配置必须完整**
   - 确保智能体节点配置了必要的参数
   - 系统提示词、模型、技能等

4. **网络连接**
   - 智能体执行需要调用 LLM API
   - 确保网络连接正常

## 故障排查

### 问题：点击测试按钮无反应
- 检查是否有节点在画布上
- 检查浏览器控制台是否有错误

### 问题：执行日志显示连接错误
- 检查 API 服务是否启动
- 检查端口 8000 是否被占用
- 检查 CORS 配置

### 问题：智能体执行失败
- 检查 API Key 是否配置正确
- 检查智能体配置是否完整
- 查看后端日志获取详细错误信息

## 未来改进

- [ ] 支持保存测试用例
- [ ] 支持测试历史记录
- [ ] 支持节点执行时间统计
- [ ] 支持可视化执行路径高亮
- [ ] 支持断点调试功能
