# SDS/MSDS危险品智能识别系统 - 产品功能说明书

**版本**: V2.0  
**发布日期**: 2026年1月  
**文档编号**: HAZMAT-FUNC-002

---

## 一、产品概述

### 1.1 产品简介

SDS/MSDS危险品智能识别系统是一款基于人工智能技术的危险品自动识别平台。系统支持解析SDS（Safety Data Sheet）和MSDS（Material Safety Data Sheet）文件，自动提取关键危险性信息，并基于内置规则库和大模型智能分析，快速判断货物是否属于危险品。

系统特别针对扫描版PDF进行了优化，支持传统OCR和多模态AI视觉识别双模式，确保各类文档都能准确提取信息。

### 1.2 核心价值

- **全格式支持**: 支持文字版PDF、扫描版PDF、SDS/MSDS多种格式
- **智能OCR**: 自动识别文档类型，优先使用传统OCR（快速免费），失败时降级到多模态AI
- **大模型增强**: 默认启用LLM智能分析，提升复杂文档的提取准确率
- **知识沉淀**: 38条内置规则+用户自定义规则，持续积累专家经验

### 1.3 技术架构

| 组件 | 技术选型 | 说明 |
|------|---------|------|
| 后端服务 | Python + FastAPI | RESTful API |
| PDF解析 | PyMuPDF | 文本提取+图片渲染 |
| 传统OCR | Tesseract + pytesseract | 免费、快速 |
| 多模态AI | qwen-vl-max-latest | 扫描版PDF智能识别 |
| LLM增强 | qwen-plus | 信息提取与判断增强 |
| 数据库 | SQLite | 轻量级存储 |
| 前端界面 | Vue 3 | 三栏式布局 |

---

## 二、功能模块

### 2.1 文件管理模块

#### 2.1.1 文件上传

- **支持格式**: PDF格式的SDS文件
- **文件大小限制**: 最大50MB
- **上传方式**: 单文件上传（点击按钮选择文件）
- **存储位置**: `data/hazmat_uploads/` 目录

#### 2.1.2 文件列表

- 显示所有已上传的SDS文件
- 支持按处理状态筛选：
  - 待处理（pending）
  - 处理中（processing）
  - 已分析（completed）
  - 已确认（confirmed）
  - 处理错误（error）
- 支持按文件名关键词搜索
- 分页展示，每页20条记录

#### 2.1.3 文件删除

- 支持删除已上传的文件
- 同时清除物理文件和数据库记录

---

### 2.2 智能解析模块

#### 2.2.1 文档类型识别

系统自动识别PDF文档类型并选择最优解析策略：

```
PDF文件上传
    ↓
PyMuPDF提取文本
    ↓
判断是否为扫描版（文本<100字符 或 有效字符比例<30%）
    ↓
┌─────────────┬─────────────┐
│  文字版PDF  │  扫描版PDF  │
│  直接解析   │  OCR识别    │
└─────────────┴─────────────┘
```

#### 2.2.2 OCR识别策略

针对扫描版PDF，系统采用分层OCR策略：

| 优先级 | OCR方案 | 技术 | 特点 |
|-------|---------|------|------|
| 1 | 传统OCR | Tesseract | 快速（3-5秒）、免费、支持中英文 |
| 2 | 多模态AI | qwen-vl-max | 准确（8-10秒）、智能理解表格 |

**智能采样优化**（针对长文档）：
- 自动识别关键页面（第1-3页产品信息、第14节运输信息）
- 20页PDF只需识别6页关键页
- 批量处理：一次API请求处理多张图片

#### 2.2.3 关键信息提取

系统自动识别并提取SDS/MSDS文件中的以下关键信息：

| 字段 | 说明 | 数据来源 | 提取模式 |
|------|------|---------|---------|
| 产品名称 | 化学品/产品的名称 | 第1节 | 正则+LLM |
| CAS号 | 化学物质登记号 | 第1/3节 | 正则匹配 |
| 危险性类别 | GHS/IMDG/DOT分类 | 第2/14节 | 正则+LLM |
| 象形图 | GHS象形图代码（GHS01-GHS09） | 第2节 | 正则匹配 |
| 信号词 | Danger/Warning/危险/警告 | 第2节 | 关键词匹配 |
| UN编号 | 联合国危险货物编号 | 第14节 | 正则匹配 |
| 运输专用名称 | 正式运输品名 | 第14节 | 正则+LLM |
| 包装组 | Packing Group I/II/III | 第14节 | 正则+LLM |
| H声明 | 危险性说明代码（H200-H400系列） | 第2节 | 正则匹配 |
| P声明 | 防范说明代码（P100-P500系列） | 第2节 | 正则匹配 |

#### 2.2.4 MSDS格式支持

系统特别优化了对旧版MSDS格式的支持：

| 特性 | SDS格式 | MSDS格式 |
|------|---------|---------|
| 章节标题 | SECTION 1, SECTION 2... | HAZARDS IDENTIFICATION, TRANSPORT INFORMATION... |
| 分类体系 | GHS | IMDG/DOT |
| 关键词 | 中文为主 | 英文为主（Flammable, Toxic等） |

#### 2.2.5 大模型增强（默认启用）

系统默认启用LLM智能增强，调用qwen-plus进行：
- **智能信息补充**: 基础解析遗漏时自动补充
- **复杂表格理解**: 解析多层嵌套表格结构
- **上下文推理**: 根据文档整体内容判断危险性
- **多语言支持**: 中英文混合文档智能识别
- **判断理由生成**: 输出is_hazardous判断依据

---

### 2.3 规则引擎模块

#### 2.3.1 内置规则库

系统预置**38条**危险品判断规则，覆盖GHS、IMDG、DOT等多种标准：

**GHS危险性类别规则（8条）：**
- 易燃气体/液体/固体
- 氧化性物质
- 高压气体
- 急性毒性
- 腐蚀性物质
- 爆炸性物质
- 自燃物质
- 遇水反应物质

**GHS象形图规则（9条）：**
- GHS01（爆炸物）
- GHS02（火焰）
- GHS03（氧化剂）
- GHS04（气瓶）
- GHS05（腐蚀）
- GHS06（骷髅头）
- GHS07（感叹号）
- GHS08（健康危害）
- GHS09（环境危害）

**IMDG/DOT运输分类规则（9条）：**
- Class 1（爆炸物）
- Class 2（气体）
- Class 3（易燃液体）
- Class 4（易燃固体）
- Class 5（氧化剂）
- Class 6（毒性物质）
- Class 7（放射性物质）
- Class 8（腐蚀性物质）
- Class 9（杂项危险品）

**包装组规则（3条）：**
- PG I（高危险）
- PG II（中危险）
- PG III（低危险）

**英文关键词规则（6条）：**
- Flammable（易燃）
- Toxic（有毒）
- Corrosive（腐蚀性）
- Oxidizing（氧化性）
- Explosive（爆炸性）
- Irritant（刺激性）

**其他规则（3条）：**
- 信号词为"危险/Danger"
- 存在UN编号
- 标记为海洋污染物（Marine Pollutant）

#### 2.3.2 规则匹配逻辑

| 操作符 | 说明 | 示例 |
|--------|------|------|
| contains | 包含 | hazard_class contains "易燃" |
| equals | 等于 | signal_word equals "危险" |
| exists | 存在 | un_number exists |
| regex | 正则匹配 | cas_number regex "\d{2,7}-\d{2}-\d" |

#### 2.3.3 判断结果

- **是危险品（hazardous）**: 匹配到任一危险品规则
- **非危险品（non_hazardous）**: 未匹配任何规则
- **置信度**: 基于匹配规则数量计算（50%-99%）

---

### 2.4 用户自定义规则（第二阶段）

#### 2.4.1 规则创建

用户可以创建自定义规则，配置项包括：
- 规则名称
- 规则描述
- 判断字段（下拉选择）
- 操作符（contains/equals/exists/regex）
- 匹配值
- 判断结果（危险品/非危险品）
- 优先级（数值越小优先级越高）

#### 2.4.2 规则管理

- **查看规则**: 分标签页展示全部规则、内置规则、自定义规则
- **启用/禁用**: 通过开关控制规则是否生效
- **删除规则**: 仅支持删除自定义规则，内置规则不可删除

---

### 2.5 人工审核与确认（第二阶段）

#### 2.5.1 结果确认

分析完成后，用户可以：
- **确认正确**: 一键确认归档，状态变为"已确认"
- **修正错误**: 打开修正对话框进行人工修正

#### 2.5.2 信息修正

用户可以修正系统提取的任意字段：
- 选择要修正的字段
- 输入正确的值
- 选择最终判断结果

#### 2.5.3 自动规则生成

修正信息时，系统提供选项：
- 勾选"根据此次修正创建新规则"
- 输入规则名称
- 系统自动创建自定义规则

---

### 2.6 历史记录与统计

#### 2.6.1 处理历史

- 记录每个文件的完整处理过程
- 支持按状态、结果、日期筛选
- 支持按文件名搜索

#### 2.6.2 统计信息

实时展示统计数据：
- 总文件数
- 危险品数量
- 非危险品数量
- 待处理数量
- 已分析数量
- 已确认数量
- 规则总数（内置/自定义）

---

## 三、用户界面

### 3.1 整体布局

采用三栏式布局设计：

```
+------------------+----------------------+------------------+
|    左栏          |       中栏           |      右栏        |
|  (文件列表)      |   (文件预览/操作)    |  (结果/规则)     |
+------------------+----------------------+------------------+
```

### 3.2 左栏 - 文件列表

- 上传新文件按钮
- 搜索框
- 状态筛选标签
- 文件列表（显示文件名、状态、结果）
- 分页控件

### 3.3 中栏 - 文件处理区

- 文件标题和操作按钮
- PDF预览区域
- 分析按钮（待处理状态）
- 确认/修正按钮（已分析状态）

### 3.4 右栏 - 结果展示

- 判断结果徽章（危险品/非危险品）
- 置信度显示
- 命中规则列表
- 提取的关键信息（可修正）
- 系统建议
- 规则管理入口

---

## 四、API接口

### 4.1 文件管理

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/hazmat/upload` | POST | 上传SDS文件 |
| `/api/hazmat/files` | GET | 获取文件列表 |
| `/api/hazmat/files/{id}` | GET | 获取文件详情 |
| `/api/hazmat/files/{id}/content` | GET | 获取PDF内容 |
| `/api/hazmat/files/{id}` | DELETE | 删除文件 |

### 4.2 分析与确认

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/hazmat/analyze/{id}` | POST | 分析文件 |
| `/api/hazmat/confirm` | POST | 确认结果 |

### 4.3 规则管理

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/hazmat/rules` | GET | 获取规则列表 |
| `/api/hazmat/rules` | POST | 创建规则 |
| `/api/hazmat/rules/{id}` | PUT | 更新规则 |
| `/api/hazmat/rules/{id}` | DELETE | 删除规则 |
| `/api/hazmat/rules/{id}/toggle` | PUT | 启用/禁用规则 |

### 4.4 其他

| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/hazmat/statistics` | GET | 获取统计信息 |
| `/api/hazmat/field-definitions` | GET | 获取字段定义 |

---

## 五、数据存储

### 5.1 数据库文件

- **位置**: `data/hazmat.db`
- **类型**: SQLite数据库

### 5.2 数据表结构

#### sds_files 表（SDS文件）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键 |
| filename | TEXT | 文件名 |
| file_path | TEXT | 文件路径 |
| file_size | INTEGER | 文件大小 |
| status | TEXT | 处理状态 |
| result | TEXT | 判断结果 |
| confidence | REAL | 置信度 |
| extracted_info | TEXT | 提取的信息（JSON） |
| matched_rules | TEXT | 匹配的规则（JSON） |
| created_at | TEXT | 创建时间 |
| confirmed_at | TEXT | 确认时间 |
| confirmed_by | TEXT | 确认人 |

#### rules 表（规则）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键 |
| name | TEXT | 规则名称 |
| description | TEXT | 规则描述 |
| rule_type | TEXT | 规则类型（builtin/custom） |
| condition_field | TEXT | 判断字段 |
| condition_operator | TEXT | 操作符 |
| condition_value | TEXT | 匹配值 |
| result | TEXT | 判断结果 |
| is_active | INTEGER | 是否启用 |
| priority | INTEGER | 优先级 |

---

## 六、安全与权限

### 6.1 认证要求

- 所有API接口均需要JWT认证
- 用户必须登录后才能访问危险品识别功能

### 6.2 权限控制

- 与系统用户管理集成
- 支持基于角色的访问控制

---

## 七、部署与运维

### 7.1 环境要求

- Python 3.10+
- Node.js 18+
- Tesseract OCR（可选，用于传统OCR）

### 7.2 依赖安装

```bash
# Python依赖
pip install pymupdf fastapi openai pytesseract pillow

# 传统OCR引擎安装（可选但推荐）
# macOS
brew install tesseract tesseract-lang

# Ubuntu/Debian
sudo apt install tesseract-ocr tesseract-ocr-chi-sim tesseract-ocr-eng
```

### 7.3 环境变量

```bash
# 大模型API密钥（用于LLM增强和多模态OCR）
export DASHSCOPE_API_KEY=your_api_key
```

### 7.4 启动方式

```bash
# 启动后端服务
python -m api.main

# 访问前端界面
http://localhost:5173
# 点击左侧菜单"危险品识别"
```

### 7.5 性能优化建议

| 场景 | 建议配置 |
|------|---------|
| 文字版PDF | 无需额外配置，直接解析 |
| 扫描版PDF（少量） | 安装Tesseract即可，快速免费 |
| 扫描版PDF（大量） | 配置DASHSCOPE_API_KEY启用多模态AI |
| 长文档（>10页） | 系统自动智能采样，无需配置 |

### 7.6 数据备份

- 数据库文件：`data/hazmat.db`
- 上传文件：`data/hazmat_uploads/`

---

## 八、版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| V1.0 | 2026-01-17 | 初始版本，完成第一阶段（MVP）和第二阶段（增强版）功能 |
| V2.0 | 2026-01-18 | 增强版：新增MSDS格式支持、传统OCR、多模态AI OCR、智能采样优化、38条内置规则 |

---

## 九、功能对比

| 功能 | V1.0 | V2.0 |
|------|------|------|
| SDS文件解析 | ✅ | ✅ |
| MSDS格式支持 | ❌ | ✅ |
| 扫描版PDF识别 | ❌ | ✅ |
| 传统OCR (Tesseract) | ❌ | ✅ |
| 多模态AI OCR | ❌ | ✅ |
| 智能页面采样 | ❌ | ✅ |
| 内置规则数量 | 20条 | 38条 |
| IMDG/DOT分类识别 | ❌ | ✅ |
| 英文关键词识别 | ❌ | ✅ |
| LLM默认启用 | ❌ | ✅ |

---

## 十、后续规划

### 第三阶段（企业版）

1. **批量上传**: 支持多文件批量上传和处理
2. **智能规则推荐**: 用户修正时自动推荐可创建的规则
3. **规则版本控制**: 支持规则的编辑历史和回滚
4. **数据导出**: 支持导出分析结果为Excel/PDF
5. **统计报表**: 提供可视化统计分析功能
6. **API对接**: 提供标准API供第三方系统集成
7. **并行OCR**: 多页PDF并行识别，进一步提速

---

**文档编写**: AI智能体编排系统  
**最后更新**: 2026年1月18日
